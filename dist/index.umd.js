!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["react","prop-types"],t):e.Metronome=t(e.React,e.PropTypes)}(this,function(e,t){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t;var n=function(){var n="START",o="STOP",r="UPDATE",i="TICK",s=null;self.onmessage=function(e){var t=e.data.action;switch(t){case n:s=setInterval(function(){return self.postMessage(i)},25);break;case o:clearInterval(s),s=null;break;case r:s&&(clearInterval(s),s=setInterval(function(){return self.postMessage(i)},25));break;default:throw new Error("Action must be of type: START, STOP or "+r+" (received "+t+").")}}}.toString();n=n.substring(n.indexOf("{")+1,n.lastIndexOf("}"));var o=new Blob([n],{type:"application/javascript"}),r=URL.createObjectURL(o),i="STOP",s=function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e};function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},p=require("../package.json").name,c=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(b,e.Component),s(b,[{key:"componentDidMount",value:function(){var t=this;this.timerWorker.onmessage=function(e){"TICK"===e.data&&t.runScheduler()},this.state.playing&&this.start()}},{key:"componentWillUnmount",value:function(){this.timerWorker.postMessage({action:i})}},{key:"render",value:function(){return this.props.render(u({},this.state,{onTempoChange:this.onTempoChange,onPlay:this.onPlay}))}}]),b);function b(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,b);var c=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,e));if(c.runScheduler=function(){for(;c.nextNoteTime<c.audioContext.currentTime+.1;){c.tick(c.currentBeat,c.nextNoteTime);var e=60/c.state.tempo;c.nextNoteTime+=c.state.beatsPerMeasure/c.ticksPerBeat*e,c.currentBeat++,c.currentBeat===c.ticksPerBeat&&(c.currentBeat=0)}},c.tick=function(e,t){var n=0===e,o=e%(c.ticksPerBeat/c.state.beatsPerMeasure)==0,r=12===c.ticksPerBeat&&e%(c.ticksPerBeat/c.state.beatsPerMeasure)!=0,i=e%(c.ticksPerBeat/(2*c.state.beatsPerMeasure))==0,s=!1,a=c.audioContext.createOscillator(),u=c.audioContext.createGain();a.connect(u),u.connect(c.audioContext.destination),4===c.state.subdivision&&(s=!0,a.frequency.setTargetAtTime(c.props.subdivisionFrequency,c.audioContext.currentTime,.001),u.gain.setTargetAtTime(c.props.subdivisionVolume,c.audioContext.currentTime,.001)),3===c.state.subdivision&&r&&(s=!0,a.frequency.setTargetAtTime(c.props.subdivisionFrequency,c.audioContext.currentTime,.001),u.gain.setTargetAtTime(c.props.subdivisionVolume,c.audioContext.currentTime,.001)),2===c.state.subdivision&&i&&(s=!0,a.frequency.setTargetAtTime(c.props.subdivisionFrequency,c.audioContext.currentTime,.001),u.gain.setTargetAtTime(c.props.subdivisionVolume,c.audioContext.currentTime,.001)),o&&(s=!0,a.frequency.setTargetAtTime(c.props.subdivisionFrequency,c.audioContext.currentTime,.001),u.gain.setTargetAtTime(c.props.subdivisionVolume,c.audioContext.currentTime,.001)),n&&(s=!0,a.frequency.setTargetAtTime(c.props.beatFrequency,c.audioContext.currentTime,1e-4),u.gain.setTargetAtTime(c.props.beatVolume,c.audioContext.currentTime,.001)),(n||o)&&c.setState(function(e){return{beat:e.beat!==c.state.beatsPerMeasure&&e.beat+1||1}},function(){c.props.onTick(c.state)}),s&&(a.start(t),a.stop(t+.05),c.setState(function(e){return{subBeat:e.subBeat!==c.state.subdivision&&e.subBeat+1||1}},function(){c.props.onSubtick(c.state)}))},c.start=function(){c.currentBeat=0,c.nextNoteTime=c.audioContext.currentTime,c.timerWorker.postMessage({action:"START",tempo:c.state.tempo,subdivision:c.state.subdivision}),c.setState({beat:0,playing:!0},function(){c.props.onStart(c.state)})},c.stop=function(){c.timerWorker.postMessage({action:i}),c.setState({playing:!1},function(){c.props.onStop(c.state)})},c.onPlay=function(){c.state.playing?c.stop():c.start()},c.onTempoChange=function(e){c.timerWorker.postMessage({action:"UPDATE"}),c.setState({tempo:e})},c.props.subdivision<1||4<c.props.subdivision)throw new Error(p+": the `subdivision` prop must be between 1 and 4.");return c.ticksPerBeat=c.props.beatsPerMeasure%3==0||c.props.subdivision%3==0?12:16,c.timerWorker=new Worker(r),c.audioContext=new(window.AudioContext||window.webkitAudioContext),c.nextNoteTime=0,c.currentBeat=0,c.state={beat:0,subBeat:0,playing:!0===c.props.autoplay,tempo:c.props.tempo,beatsPerMeasure:c.props.beatsPerMeasure,subdivision:c.props.subdivision},c}return c.propTypes={tempo:t.number,beatsPerMeasure:t.number,subdivision:t.number,autoplay:t.bool,beatFrequency:t.number,beatVolume:t.number,subdivisionFrequency:t.number,subdivisionVolume:t.number,render:t.func,onTick:t.func,onSubtick:t.func,onStart:t.func,onStop:t.func},c.defaultProps={tempo:120,beatsPerMeasure:4,subdivision:1,beatFrequency:880,beatVolume:1,subdivisionFrequency:440,subdivisionVolume:.5,autoplay:!1,render:function(){return null},onTick:function(){},onSubtick:function(){},onStart:function(){},onStop:function(){}},c});
//# sourceMappingURL=index.umd.js.map
